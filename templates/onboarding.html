{% extends "base.html" %}

{% block title %}Onboarding - SmartHire AI{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-1 text-light">
                        <i class="fas fa-user-clock me-2"></i>Employee Onboarding
                    </h1>
                    <p class="text-muted mb-0">Track and manage new hire onboarding tasks and progress</p>
                </div>
                <div>
                    <button class="btn btn-outline-light" id="refreshBtn">
                        <i class="fas fa-sync-alt me-1"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Progress Overview -->
    {% if selected_employee and checklist %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <h5 class="text-light mb-2">{{ selected_employee.full_name }} - Onboarding Progress</h5>
                            <div class="progress bg-dark bg-opacity-50 mb-2" style="height: 10px;">
                                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: {{ checklist.get_progress() }}%;" 
                                     aria-valuenow="{{ checklist.get_progress() }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">{{ "%.0f"|format(checklist.get_progress()) }}% Complete</small>
                                {% set pending_count = checklist.tasks|selectattr('is_completed', 'equalto', false)|list|length %}
                                {% if pending_count > 0 %}
                                <small class="text-warning">
                                    <i class="fas fa-exclamation-triangle me-1"></i> {{ pending_count }} task{{ 's' if pending_count > 1 else '' }} pending
                                </small>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex flex-wrap justify-content-md-end gap-2">
                                <div class="border-end pe-3 me-3">
                                    <h6 class="text-light mb-1">{{ checklist.tasks|length }}</h6>
                                    <small class="text-muted">Total Tasks</small>
                                </div>
                                <div class="border-end pe-3 me-3">
                                    <h6 class="text-success mb-1">{{ checklist.tasks|selectattr('is_completed', 'equalto', true)|list|length }}</h6>
                                    <small class="text-muted">Completed</small>
                                </div>
                                <div class="border-end pe-3 me-3">
                                    <h6 class="text-warning mb-1">{{ checklist.tasks|selectattr('is_completed', 'equalto', false)|list|length }}</h6>
                                    <small class="text-muted">Pending</small>
                                </div>
                                <div>
                                    <h6 class="text-info mb-1">{{ (now() - checklist.created_at).days if checklist.created_at else 0 }}</h6>
                                    <small class="text-muted">Days Since Start</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <h5 class="text-light mb-2">Onboarding Progress</h5>
                            <div class="progress bg-dark bg-opacity-50 mb-2" style="height: 10px;">
                                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 25%;" 
                                     aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">25% Complete</small>
                                <small class="text-warning">
                                    <i class="fas fa-exclamation-triangle me-1"></i> 2 tasks overdue
                                </small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex flex-wrap justify-content-md-end gap-2">
                                <div class="border-end pe-3 me-3">
                                    <h6 class="text-light mb-1">5</h6>
                                    <small class="text-muted">Total Tasks</small>
                                </div>
                                <div class="border-end pe-3 me-3">
                                    <h6 class="text-success mb-1">2</h6>
                                    <small class="text-muted">Completed</small>
                                </div>
                                <div class="border-end pe-3 me-3">
                                    <h6 class="text-warning mb-1">2</h6>
                                    <small class="text-muted">In Progress</small>
                                </div>
                                <div>
                                    <h6 class="text-danger mb-1">1</h6>
                                    <small class="text-muted">Overdue</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row">
        <!-- Employee/Candidate Selection Sidebar -->
        <div class="col-lg-4 mb-4 order-lg-2">
            {% if selected_employee %}
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-user me-2"></i>Employee Details
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-muted small">Name</label>
                        <p class="text-light mb-0">{{ selected_employee.full_name }}</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Email</label>
                        <p class="text-light mb-0">{{ selected_employee.email }}</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Position</label>
                        <p class="text-light mb-0">{{ selected_employee.position or 'N/A' }}</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Department</label>
                        <p class="text-light mb-0">{{ selected_employee.department or 'N/A' }}</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Status</label>
                        <p class="text-light mb-0">
                            <span class="badge bg-{{ 'success' if selected_employee.status == 'Active' else 'warning' if selected_employee.status == 'Onboarding' else 'secondary' }} bg-opacity-25 text-{{ 'success' if selected_employee.status == 'Active' else 'warning' if selected_employee.status == 'Onboarding' else 'secondary' }}">
                                {{ selected_employee.status or 'N/A' }}
                            </span>
                        </p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted small">Hire Date</label>
                        <p class="text-light mb-0">{{ selected_employee.hire_date.strftime('%B %d, %Y') if selected_employee.hire_date else 'N/A' }}</p>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-user-tie me-2"></i>Select Employee/Candidate
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="employeeSearch" class="form-label text-light">Search Employee</label>
                        <input type="text" class="form-control bg-dark text-light border-secondary" 
                               id="employeeSearch" placeholder="Search by name...">
                    </div>
                    <div id="employeeList" class="list-group" style="max-height: 400px; overflow-y: auto;">
                        <div class="text-muted text-center py-3">
                            <i class="fas fa-search me-2"></i>Search or select an employee
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

        </div>
        
        <!-- Main Content -->
        <div class="col-lg-8 order-lg-1">
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-clipboard-list me-2"></i>Onboarding Checklist
                    </h5>
                    <div class="dropdown">
                        <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-filter me-1"></i> Filter
                        </button>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="filterDropdown">
                            <li><a class="dropdown-item active" href="#" data-filter="all">All Tasks</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="overdue">Overdue</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="today">Due Today</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="upcoming">Upcoming</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" data-filter="my-tasks">My Tasks</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle mb-0">
                            <thead class="bg-dark bg-opacity-50">
                                <tr>
                                    <th class="ps-4">Task</th>
                                    <th>Status</th>
                                    <th>Assigned To</th>
                                    <th>Due Date</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="onboardingTasks">
                                {% if selected_employee and checklist and checklist.tasks %}
                                    {% for task in checklist.tasks %}
                                    <tr class="task-item" data-status="{{ 'completed' if task.is_completed else 'pending' }}" data-task-id="{{ task.id }}">
                                        <td class="ps-4">
                                            <div class="form-check">
                                                <input class="form-check-input task-checkbox" type="checkbox" 
                                                       id="task{{ task.id }}" data-task-id="{{ task.id }}" 
                                                       {{ 'checked' if task.is_completed else '' }}>
                                                <label class="form-check-label" for="task{{ task.id }}">
                                                    {{ task.task_name }}
                                                    {% if task.task_description %}
                                                    <small class="d-block text-muted">{{ task.task_description }}</small>
                                                    {% endif %}
                                                </label>
                                            </div>
                                        </td>
                                        <td>
                                            {% if task.is_completed %}
                                                <span class="badge bg-success bg-opacity-25 text-success">
                                                    <i class="fas fa-check-circle me-1"></i> Completed
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary bg-opacity-25 text-muted">
                                                    <i class="far fa-clock me-1"></i> Pending
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-xs me-2">
                                                    <div class="avatar-title bg-primary bg-opacity-10 text-primary rounded-circle">
                                                        HR
                                                    </div>
                                                </div>
                                                HR Department
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <i class="far fa-calendar-alt text-muted me-2"></i>
                                                <span>{{ (checklist.created_at + timedelta(days=task.order_index + 1)).strftime('%b %d') }}</span>
                                            </div>
                                        </td>
                                        <td class="text-end pe-4">
                                            <div class="dropdown">
                                                <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                        id="task{{ task.id }}Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task{{ task.id }}Dropdown">
                                                    <li>
                                                        <a class="dropdown-item" href="#" onclick="toggleTaskCompletion({{ task.id }}, {{ 'false' if task.is_completed else 'true' }})">
                                                            <i class="fas fa-{{ 'undo' if task.is_completed else 'check' }} me-2"></i>{{ 'Mark as Incomplete' if task.is_completed else 'Mark as Complete' }}
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal" data-task-id="{{ task.id }}">
                                                            <i class="far fa-edit me-2"></i>Edit Task
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                <!-- Task 1 -->
                                <tr class="task-item" data-status="overdue" data-assigned-to="hr">
                                    <td class="ps-4">
                                        <div class="form-check">
                                            <input class="form-check-input task-checkbox" type="checkbox" id="task1" data-task-id="1">
                                            <label class="form-check-label" for="task1">
                                                Document Collection
                                                <small class="d-block text-muted">Collect all required documents</small>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-danger bg-opacity-25 text-danger">
                                            <i class="fas fa-exclamation-circle me-1"></i> Overdue
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-xs me-2">
                                                <div class="avatar-title bg-primary bg-opacity-10 text-primary rounded-circle">
                                                    HR
                                                </div>
                                            </div>
                                            HR Department
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="far fa-calendar-alt text-muted me-2"></i>
                                            <span class="text-danger">Yesterday</span>
                                        </div>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                    id="task1Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task1Dropdown">
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="markComplete(this)">
                                                        <i class="fas fa-check me-2"></i>Mark as Complete
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal">
                                                        <i class="fas fa-user-edit me-2"></i>Reassign Task
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal">
                                                        <i class="far fa-edit me-2"></i>Edit Task
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#">
                                                        <i class="far fa-trash-alt me-2"></i>Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Task 2 -->
                                <tr class="task-item" data-status="in-progress" data-assigned-to="it">
                                    <td class="ps-4">
                                        <div class="form-check">
                                            <input class="form-check-input task-checkbox" type="checkbox" id="task2" data-task-id="2" checked>
                                            <label class="form-check-label" for="task2">
                                                Laptop/Asset Allocation
                                                <small class="d-block text-muted">Assign and configure work equipment</small>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning bg-opacity-25 text-warning">
                                            <i class="fas fa-sync-alt fa-spin me-1"></i> In Progress
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-xs me-2">
                                                <div class="avatar-title bg-info bg-opacity-10 text-info rounded-circle">
                                                    IT
                                                </div>
                                            </div>
                                            IT Department
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="far fa-calendar-alt text-muted me-2"></i>
                                            <span>Today</span>
                                        </div>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                    id="task2Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task2Dropdown">
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="markComplete(this)">
                                                        <i class="fas fa-check me-2"></i>Mark as Complete
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal">
                                                        <i class="fas fa-user-edit me-2"></i>Reassign Task
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal">
                                                        <i class="far fa-edit me-2"></i>Edit Task
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#">
                                                        <i class="far fa-trash-alt me-2"></i>Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Task 3 -->
                                <tr class="task-item" data-status="completed" data-assigned-to="it">
                                    <td class="ps-4">
                                        <div class="form-check">
                                            <input class="form-check-input task-checkbox" type="checkbox" id="task3" data-task-id="3" checked>
                                            <label class="form-check-label" for="task3">
                                                Email Account Creation
                                                <small class="d-block text-muted">Create company email account</small>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success bg-opacity-25 text-success">
                                            <i class="fas fa-check-circle me-1"></i> Completed
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-xs me-2">
                                                <div class="avatar-title bg-info bg-opacity-10 text-info rounded-circle">
                                                    IT
                                                </div>
                                            </div>
                                            IT Department
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="far fa-calendar-alt text-muted me-2"></i>
                                            <span>Yesterday</span>
                                        </div>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                    id="task3Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task3Dropdown">
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="markIncomplete(this)">
                                                        <i class="fas fa-undo me-2"></i>Mark as Incomplete
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal">
                                                        <i class="fas fa-user-edit me-2"></i>Reassign Task
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal">
                                                        <i class="far fa-edit me-2"></i>Edit Task
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#">
                                                        <i class="far fa-trash-alt me-2"></i>Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Task 4 -->
                                <tr class="task-item" data-status="in-progress" data-assigned-to="it">
                                    <td class="ps-4">
                                        <div class="form-check">
                                            <input class="form-check-input task-checkbox" type="checkbox" id="task4" data-task-id="4">
                                            <label class="form-check-label" for="task4">
                                                System Access Creation
                                                <small class="d-block text-muted">Set up access to required systems</small>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning bg-opacity-25 text-warning">
                                            <i class="fas fa-sync-alt fa-spin me-1"></i> In Progress
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-xs me-2">
                                                <div class="avatar-title bg-info bg-opacity-10 text-info rounded-circle">
                                                    IT
                                                </div>
                                            </div>
                                            IT Department
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="far fa-calendar-alt text-muted me-2"></i>
                                            <span>Tomorrow</span>
                                        </div>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                    id="task4Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task4Dropdown">
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="markComplete(this)">
                                                        <i class="fas fa-check me-2"></i>Mark as Complete
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal">
                                                        <i class="fas fa-user-edit me-2"></i>Reassign Task
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal">
                                                        <i class="far fa-edit me-2"></i>Edit Task
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#">
                                                        <i class="far fa-trash-alt me-2"></i>Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Task 5 -->
                                <tr class="task-item" data-status="completed" data-assigned-to="admin">
                                    <td class="ps-4">
                                        <div class="form-check">
                                            <input class="form-check-input task-checkbox" type="checkbox" id="task5" data-task-id="5" checked>
                                            <label class="form-check-label" for="task5">
                                                ID Card Request
                                                <small class="d-block text-muted">Issue company identification</small>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success bg-opacity-25 text-success">
                                            <i class="fas fa-check-circle me-1"></i> Completed
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-xs me-2">
                                                <div class="avatar-title bg-secondary bg-opacity-10 text-secondary rounded-circle">
                                                    AD
                                                </div>
                                            </div>
                                            Admin Team
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="far fa-calendar-alt text-muted me-2"></i>
                                            <span>2 days ago</span>
                                        </div>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                    id="task5Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task5Dropdown">
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="markIncomplete(this)">
                                                        <i class="fas fa-undo me-2"></i>Mark as Incomplete
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal">
                                                        <i class="fas fa-user-edit me-2"></i>Reassign Task
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal">
                                                        <i class="far fa-edit me-2"></i>Edit Task
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#">
                                                        <i class="far fa-trash-alt me-2"></i>Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Task 6 -->
                                <tr class="task-item" data-status="pending" data-assigned-to="hr">
                                    <td class="ps-4">
                                        <div class="form-check">
                                            <input class="form-check-input task-checkbox" type="checkbox" id="task6" data-task-id="6">
                                            <label class="form-check-label" for="task6">
                                                Team Introduction
                                                <small class="d-block text-muted">Schedule team introduction meeting</small>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary bg-opacity-25 text-muted">
                                            <i class="far fa-clock me-1"></i> Pending
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-xs me-2">
                                                <div class="avatar-title bg-primary bg-opacity-10 text-primary rounded-circle">
                                                    HR
                                                </div>
                                            </div>
                                            HR Department
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="far fa-calendar-alt text-muted me-2"></i>
                                            <span>Tomorrow</span>
                                        </div>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                                                    id="task6Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task6Dropdown">
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="markComplete(this)">
                                                        <i class="fas fa-check me-2"></i>Mark as Complete
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal">
                                                        <i class="fas fa-user-edit me-2"></i>Reassign Task
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal">
                                                        <i class="far fa-edit me-2"></i>Edit Task
                                                    </a>
                                                </li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#">
                                                        <i class="far fa-trash-alt me-2"></i>Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Orientation Scheduling</td>
                                    <td><span class="badge bg-secondary">Pending</span></td>
                                    <td>HR</td>
                                    <td>Day 1</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1" onclick="markComplete(this)">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="reassignTask(this)">
                                            <i class="fas fa-user-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Job Description Card -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4 d-none" id="jobDescriptionCard">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-briefcase me-2"></i>Job Description
                    </h5>
                </div>
                <div class="card-body">
                    <div id="jobDescriptionContent" class="text-light" style="max-height: 300px; overflow-y: auto;">
                        <div class="text-muted text-center py-3">
                            Select an employee to view job description
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Task Filters -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-filter me-2"></i>Filter Tasks
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-light">Status</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="" id="filterAll" checked>
                            <label class="form-check-label text-light" for="filterAll">
                                All Tasks
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input filter-status" type="checkbox" value="pending" id="filterPending">
                            <label class="form-check-label text-light" for="filterPending">
                                <span class="badge bg-secondary bg-opacity-25 text-muted">
                                    <i class="far fa-clock me-1"></i> Pending
                                </span>
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input filter-status" type="checkbox" value="in-progress" id="filterInProgress">
                            <label class="form-check-label text-light" for="filterInProgress">
                                <span class="badge bg-warning bg-opacity-25 text-warning">
                                    <i class="fas fa-sync-alt fa-spin me-1"></i> In Progress
                                </span>
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input filter-status" type="checkbox" value="completed" id="filterCompleted">
                            <label class="form-check-label text-light" for="filterCompleted">
                                <span class="badge bg-success bg-opacity-25 text-success">
                                    <i class="fas fa-check-circle me-1"></i> Completed
                                </span>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input filter-status" type="checkbox" value="overdue" id="filterOverdue">
                            <label class="form-check-label text-light" for="filterOverdue">
                                <span class="badge bg-danger bg-opacity-25 text-danger">
                                    <i class="fas fa-exclamation-circle me-1"></i> Overdue
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-light">Assigned To</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input filter-assigned" type="checkbox" value="all" id="filterAllDepartments" checked>
                            <label class="form-check-label text-light" for="filterAllDepartments">
                                All Departments
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input filter-assigned" type="checkbox" value="hr" id="filterHR">
                            <label class="form-check-label text-light" for="filterHR">
                                <span class="badge bg-primary bg-opacity-10 text-primary">HR Department</span>
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input filter-assigned" type="checkbox" value="it" id="filterIT">
                            <label class="form-check-label text-light" for="filterIT">
                                <span class="badge bg-info bg-opacity-10 text-info">IT Department</span>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input filter-assigned" type="checkbox" value="admin" id="filterAdmin">
                            <label class="form-check-label text-light" for="filterAdmin">
                                <span class="badge bg-secondary bg-opacity-10 text-secondary">Admin Team</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button class="btn btn-outline-light" id="applyFilters">
                            <i class="fas fa-filter me-1"></i> Apply Filters
                        </button>
                        <button class="btn btn-link text-light mt-2" id="resetFilters">
                            <i class="fas fa-undo me-1"></i> Reset Filters
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Task Stats -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-chart-pie me-2"></i>Task Statistics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-light">Completion Rate</span>
                            <span class="text-light">40%</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 8px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 40%;" 
                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted small">HR Department</span>
                            <span class="text-muted small">1/2</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 6px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 50%;" 
                                 aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted small">IT Department</span>
                            <span class="text-muted small">1/3</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 6px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 33%;" 
                                 aria-valuenow="33" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted small">Admin Team</span>
                            <span class="text-muted small">1/1</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 6px;">
                            <div class="progress-bar bg-secondary" role="progressbar" style="width: 100%;" 
                                 aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Upcoming Deadlines -->
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="far fa-calendar-alt me-2"></i>Upcoming Deadlines
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0 text-light">Document Collection</h6>
                                    <small class="text-danger">
                                        <i class="far fa-clock me-1"></i> Overdue
                                    </small>
                                </div>
                                <span class="badge bg-danger bg-opacity-25 text-danger">HR</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0 text-light">Laptop/Asset Allocation</h6>
                                    <small class="text-warning">
                                        <i class="far fa-clock me-1"></i> Due Today
                                    </small>
                                </div>
                                <span class="badge bg-info bg-opacity-25 text-info">IT</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0 text-light">Team Introduction</h6>
                                    <small class="text-muted">
                                        <i class="far fa-clock me-1"></i> Tomorrow
                                    </small>
                                </div>
                                <span class="badge bg-primary bg-opacity-25 text-primary">HR</span>
                            </div>
                        </div>
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0 text-light">System Access Creation</h6>
                                    <small class="text-muted">
                                        <i class="far fa-clock me-1"></i> In 2 days
                                    </small>
                                </div>
                                <span class="badge bg-info bg-opacity-25 text-info">IT</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0 text-light">
                        <i class="fas fa-chart-line me-2"></i>Onboarding Progress
                    </h5>
                </div>
                <div class="card-body text-light">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Completion</span>
                            <span>14%</span>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 14%;" aria-valuenow="14" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Pending Tasks</span>
                            <span class="badge bg-primary rounded-pill">7</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Completed Tasks</span>
                            <span class="badge bg-success rounded-pill">0</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center text-danger">
                            <span>Overdue Tasks</span>
                            <span class="badge bg-danger rounded-pill">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Deadlines -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Upcoming Deadlines</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for task in [
                            {'title': 'Document Collection', 'date': 'Today', 'assigned': 'HR'},
                            {'title': 'IT Setup', 'date': 'Tomorrow', 'assigned': 'IT'},
                            {'title': 'Orientation', 'date': 'Day 1', 'assigned': 'HR'}
                        ] %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ task.title }}</h6>
                                <small class="text-muted">{{ task.date }}</small>
                            </div>
                            <small class="text-muted">Assigned to: {{ task.assigned }}</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Hire Modal -->
<div class="modal fade" id="newHireModal" tabindex="-1" aria-labelledby="newHireModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header border-secondary">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newHireModalLabel">Add New Hire</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newHireForm">
                    <div class="mb-3">
                        <label for="newHireName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="newHireName" name="newHireName" autocomplete="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="newHireEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="newHireEmail" name="newHireEmail" autocomplete="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="newHireDepartment" class="form-label">Department</label>
                        <select class="form-select" id="newHireDepartment" required>
                            <option value="" selected disabled>Select Department</option>
                            <option value="it">IT</option>
                            <option value="hr">Human Resources</option>
                            <option value="finance">Finance</option>
                            <option value="marketing">Marketing</option>
                            <option value="operations">Operations</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="newHireStartDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="newHireStartDate" name="newHireStartDate" autocomplete="off" required>
                    </div>
                    <div class="mb-3">
                        <label for="resumeFile" class="form-label">Resume (PDF/DOCX)</label>
                        <input type="file" class="form-control" id="resumeFile" accept=".pdf,.doc,.docx">
                        <div class="form-text">Upload the candidate's resume to extract information</div>
                    </div>
                    <button type="button" class="btn btn-outline-primary mb-3" onclick="analyzeResume()">
                        <i class="fas fa-file-import me-1"></i>Analyze Resume
                    </button>
                    
                    <!-- Resume Analysis Results -->
                    <div class="card mb-3 d-none" id="resumeAnalysisResults">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Resume Analysis Results</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Skills</label>
                                <div id="extractedSkills" class="d-flex flex-wrap gap-1">
                                    <!-- Skills will be added here -->
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Experience</label>
                                <div id="extractedExperience" class="list-group">
                                    <!-- Experience items will be added here -->
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Education</label>
                                <div id="extractedEducation" class="list-group">
                                    <!-- Education items will be added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addNewHire()">Create Onboarding</button>
            </div>
        </div>
    </div>
</div>

<!-- Reassign Task Modal -->
<div class="modal fade" id="reassignModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Reassign Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Task</label>
                    <input type="text" class="form-control" id="taskName" readonly>
                </div>
                <div class="mb-3">
                    <label for="assignTo" class="form-label">Assign To</label>
                    <select class="form-select" id="assignTo">
                        <option value="hr">HR Department</option>
                        <option value="it">IT Department</option>
                        <option value="admin">Admin Department</option>
                        <option value="manager">Hiring Manager</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="dueDate" class="form-label">Due Date</label>
                    <input type="date" class="form-control" id="dueDate">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="confirmReassignment()">Reassign</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="selectCandidateModal" tabindex="-1" aria-labelledby="selectCandidateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="selectCandidateModalLabel">Select Candidate</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if sample_candidates %}
                <div class="table-responsive">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Score</th>
                                <th>Added On</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for candidate in sample_candidates %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="me-2">
                                            <i class="fas fa-user-circle fa-lg"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold">{{ candidate.name }}</div>
                                            {% if candidate.summary %}
                                            <small class="text-muted">{{ candidate.summary[:50] }}...</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                </td>
                                <td>{{ candidate.job_desc }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if candidate.score >= 80 else 'warning' if candidate.score >= 60 else 'danger' }}">
                                        {{ "%.1f"|format(candidate.score) }}%
                                    </span>
                                </td>
                                <td>{{ candidate.created_at.strftime('%Y-%m-%d') }}</td>
                                <td>
                                    <a href="{{ url_for('onboarding', candidate_id=candidate.id) }}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-user-plus me-1"></i> Select
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                    <p class="mb-0">No candidates found. Please add candidates first.</p>
                    <a href="{{ url_for('pre_onboarding') }}" class="btn btn-primary mt-3">
                        <i class="fas fa-plus me-1"></i> Add Candidate
                    </a>
                </div>
                {% endif %}
            </div>
            <div class="modal-footer border-secondary">
                <a href="{{ url_for('pre_onboarding') }}" class="btn btn-outline-primary me-auto">
                    <i class="fas fa-plus me-1"></i> Add New Candidate
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- New Hire Details Card (initially hidden) -->
<div class="card bg-dark bg-opacity-25 border-secondary mb-4 d-none" id="newHireCard">
    <div class="card-header bg-transparent border-secondary d-flex justify-content-between align-items-center">
        <h5 class="mb-0 text-light">
            <i class="fas fa-user-plus me-2"></i>New Hire Details
        </h5>
        <button class="btn btn-sm btn-outline-secondary" onclick="resetOnboarding()">
            <i class="fas fa-redo me-1"></i>Start Over
        </button>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Name:</strong> <span id="candidateName">-</span></p>
                <p><strong>Email:</strong> <span id="candidateEmail">-</span></p>
                <p><strong>Position:</strong> <span id="candidatePosition">-</span></p>
            </div>
            <div class="col-md-6">
                <p><strong>Experience:</strong> <span id="candidateExperience">-</span></p>
                <p><strong>Skills:</strong> <span id="candidateSkills">-</span></p>
                <p><strong>Hire Date:</strong> <span id="hireDate">-</span></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/onboarding.js') }}"></script>
<script>
// Global variables
let tasks = [
    {
        id: 1,
        title: 'Document Collection',
        description: 'Collect all required documents',
        status: 'overdue',
        assignedTo: 'hr',
        dueDate: '2023-11-17',
        completed: false
    },
    {
        id: 2,
        title: 'Laptop/Asset Allocation',
        description: 'Assign and configure work equipment',
        status: 'in-progress',
        assignedTo: 'it',
        dueDate: '2023-11-18',
        completed: false
    },
    {
        id: 3,
        title: 'Email Account Creation',
        description: 'Create company email account',
        status: 'completed',
        assignedTo: 'it',
        dueDate: '2023-11-17',
        completed: true
    },
    {
        id: 4,
        title: 'System Access Creation',
        description: 'Set up access to required systems',
        status: 'in-progress',
        assignedTo: 'it',
        dueDate: '2023-11-20',
        completed: false
    },
    {
        id: 5,
        title: 'ID Card Request',
        description: 'Issue company identification',
        status: 'completed',
        assignedTo: 'admin',
        dueDate: '2023-11-16',
        completed: true
    },
    {
        id: 6,
        title: 'Team Introduction',
        description: 'Schedule team introduction meeting',
        status: 'pending',
        assignedTo: 'hr',
        dueDate: '2023-11-19',
        completed: false
    }
];

// DOM Elements
const taskList = document.getElementById('onboardingTasks');
const progressBar = document.querySelector('.progress-bar');
const progressText = document.querySelector('.progress-bar').parentElement.nextElementSibling.firstElementChild;
const taskCounts = {
    total: document.querySelector('.col-md-6 .d-flex div:nth-child(1) h6'),
    completed: document.querySelector('.col-md-6 .d-flex div:nth-child(2) h6'),
    inProgress: document.querySelector('.col-md-6 .d-flex div:nth-child(3) h6'),
    overdue: document.querySelector('.col-md-6 .d-flex div:nth-child(4) h6')
};

// Handle task checkbox changes for employee-specific onboarding
document.addEventListener('change', function(e) {
    if (e.target.matches('.task-checkbox')) {
        const taskId = parseInt(e.target.dataset.taskId);
        const completed = e.target.checked;
        toggleTaskCompletion(taskId, completed);
    }
});

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Check if we have a selected candidate in sessionStorage or URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    let selectedCandidateId = urlParams.get('candidateId');
    const candidateData = selectedCandidateId ? null : sessionStorage.getItem('selectedCandidate');
    
    // If we have a candidate ID in the URL, use that instead of session storage
    if (!selectedCandidateId && candidateData) {
        try {
            const candidate = JSON.parse(candidateData);
            selectedCandidateId = candidate.id;
        } catch (e) {
            console.error('Error parsing candidate data:', e);
        }
    }
    
    // Update task list and progress
    updateTaskList();
    updateProgress();
    
    // Set up event listeners
    setupEventListeners();
    
    if (candidateData) {
        try {
            const candidate = JSON.parse(candidateData);
            
            // Auto-fill the new hire form
            const form = document.getElementById('newHireForm');
            if (form) {
                // Fill in basic information
                if (form.elements['fullName']) form.elements['fullName'].value = candidate.name || '';
                if (form.elements['email']) form.elements['email'].value = candidate.email || '';
                if (form.elements['position']) form.elements['position'].value = candidate.position || '';
                
                // Set department based on position
                const departmentSelect = form.elements['department'];
                if (departmentSelect) {
                    const position = (candidate.position || '').toLowerCase();
                    if (position.includes('design')) {
                        departmentSelect.value = 'design';
                    } else if (position.includes('data') || position.includes('scientist') || position.includes('analyst')) {
                        departmentSelect.value = 'data';
                    } else if (position.includes('hr') || position.includes('human')) {
                        departmentSelect.value = 'hr';
                    } else if (position.includes('marketing')) {
                        departmentSelect.value = 'marketing';
                    } else {
                        departmentSelect.value = 'engineering';
                    }
                }
                
                // Set start date to next Monday
                const today = new Date();
                const day = today.getDay();
                const daysUntilMonday = day === 0 ? 1 : 8 - day;
                const nextMonday = new Date();
                nextMonday.setDate(today.getDate() + daysUntilMonday);
                
                const startDateInput = form.elements['startDate'];
                if (startDateInput) {
                    startDateInput.valueAsDate = nextMonday;
                }
                
                // Show success message
                showToast('success', 'Candidate Data Loaded', `Successfully loaded data for ${candidate.name}`);
                
                // Show the onboarding tasks
                const onboardingTasks = document.getElementById('onboardingTasks');
                if (onboardingTasks) {
                    onboardingTasks.classList.remove('d-none');
                }
            }
            
            // Remove the stored candidate data to prevent auto-filling on page refresh
            sessionStorage.removeItem('selectedCandidate');
            
        } catch (error) {
            console.error('Error parsing candidate data:', error);
            showToast('error', 'Error', 'Failed to load candidate data');
        }
    }
    
    // Make sure selectedCandidateId is defined and sampleCandidates exists
    if (typeof sampleCandidates !== 'undefined' && selectedCandidateId) {
        // Find the selected candidate in the sample candidates
        const selectedCandidate = sampleCandidates.find(c => c.id === parseInt(selectedCandidateId));
        
        if (selectedCandidate) {
            // Update the task list with candidate-specific information
            updateTaskListWithCandidate(selectedCandidate);
            const newHireCard = document.getElementById('newHireCard');
            if (newHireCard) {
                newHireCard.style.display = 'block';
                
                // Pre-fill the form with selected candidate's data
                const form = document.getElementById('newHireForm');
                if (form) {
                    form.elements['newHireName'].value = selectedCandidate.name || '';
                    form.elements['newHireEmail'].value = selectedCandidate.email || '';
                    form.elements['newHirePosition'].value = selectedCandidate.position || '';
                    
                    // Set department based on position
                    const departmentSelect = document.getElementById('newHireDepartment');
                    if (departmentSelect) {
                        const position = (selectedCandidate.position || '').toLowerCase();
                        if (position.includes('design')) {
                            departmentSelect.value = 'design';
                        } else if (position.includes('data') || position.includes('scientist') || position.includes('analyst')) {
                            departmentSelect.value = 'data';
                        } else if (position.includes('hr') || position.includes('human')) {
                            departmentSelect.value = 'hr';
                        } else if (position.includes('marketing')) {
                            departmentSelect.value = 'marketing';
                        } else {
                            departmentSelect.value = 'engineering';
                        }
                    }
                    
                    // Set start date to next Monday
                    const today = new Date();
                    const day = today.getDay();
                    const daysUntilMonday = day === 0 ? 1 : 8 - day;
                    const nextMonday = new Date();
                    nextMonday.setDate(today.getDate() + daysUntilMonday);
                    
                    const startDateInput = document.getElementById('newHireStartDate');
                    if (startDateInput) {
                        startDateInput.valueAsDate = nextMonday;
                    }
                }
                
                // Show success message
                showToast('success', 'Candidate Selected', `You can now complete the onboarding process for ${selectedCandidate.name}`);
            }
        }
    }
});

    // Update task list with candidate information
function updateTaskListWithCandidate(candidate) {
    // Update task descriptions with candidate name
    const taskElements = document.querySelectorAll('.task-item');
    taskElements.forEach(task => {
        const title = task.querySelector('.form-check-label');
        if (title) {
            title.textContent = title.textContent.replace('[Candidate]', candidate.name);
        }
    });
    
    // Update the page title
    document.querySelector('h1').textContent = `Onboarding: ${candidate.name}`;
}

// Update the task list based on filters
function updateTaskList() {
    // This would be populated from the tasks array in a real application
    // For now, we're just showing all tasks
    const taskList = document.getElementById('onboardingTasks');
    if (!taskList) return;
    
    // Sort tasks by due date (overdue first, then by date)
    const sortedTasks = [...tasks].sort((a, b) => {
        const dateA = new Date(a.dueDate);
        const dateB = new Date(b.dueDate);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Overdue tasks first
        if (dateA < today && dateB >= today) return -1;
        if (dateA >= today && dateB < today) return 1;
        
        // Then sort by due date
        return dateA - dateB;
    });
    
    // Clear existing tasks
    taskList.innerHTML = '';
    
    // Render tasks
    sortedTasks.forEach(task => {
        const taskElement = createTaskElement(task);
        taskList.appendChild(taskElement);
    });
}

// Create a task element
function createTaskElement(task) {
    const dueDate = new Date(task.dueDate);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const isOverdue = dueDate < today && !task.completed;
    const isDueToday = dueDate.toDateString() === today.toDateString() && !task.completed;
    
    // Determine status text and class
    let statusText, statusClass, statusIcon;
    if (task.completed) {
        statusText = 'Completed';
        statusClass = 'success';
        statusIcon = 'check-circle';
    } else if (isOverdue) {
        statusText = 'Overdue';
        statusClass = 'danger';
        statusIcon = 'exclamation-circle';
    } else if (task.status === 'in-progress') {
        statusText = 'In Progress';
        statusClass = 'warning';
        statusIcon = 'sync-alt fa-spin';
    } else {
        statusText = 'Pending';
        statusClass = 'secondary';
        statusIcon = 'clock';
    }
    
    // Format due date
    let dueDateText;
    const diffTime = Math.abs(dueDate - today);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (isDueToday) {
        dueDateText = 'Today';
    } else if (isOverdue) {
        dueDateText = `${diffDays} days ago`;
    } else if (diffDays === 1) {
        dueDateText = 'Tomorrow';
    } else if (diffDays <= 7) {
        dueDateText = `In ${diffDays} days`;
    } else {
        dueDateText = dueDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
    
    // Create the task element
    const taskElement = document.createElement('tr');
    taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;
    taskElement.dataset.status = task.status;
    taskElement.dataset.assignedTo = task.assignedTo;
    
    taskElement.innerHTML = `
        <td class="ps-4">
            <div class="form-check">
                <input class="form-check-input task-checkbox" type="checkbox" 
                       id="task${task.id}" data-task-id="${task.id}" 
                       ${task.completed ? 'checked' : ''}>
                <label class="form-check-label" for="task${task.id}">
                    ${task.title}
                    <small class="d-block text-muted">${task.description}</small>
                </label>
            </div>
        </td>
        <td>
            <span class="badge bg-${statusClass} bg-opacity-25 text-${statusClass}">
                <i class="fas fa-${statusIcon} me-1"></i> ${statusText}
            </span>
        </td>
        <td>
            <div class="d-flex align-items-center">
                <div class="avatar-xs me-2">
                    <div class="avatar-title bg-${task.assignedTo === 'hr' ? 'primary' : task.assignedTo === 'it' ? 'info' : 'secondary'}-opacity-10 text-${task.assignedTo === 'hr' ? 'primary' : task.assignedTo === 'it' ? 'info' : 'secondary'} rounded-circle">
                        ${task.assignedTo.toUpperCase().substring(0, 2)}
                    </div>
                </div>
                ${task.assignedTo === 'hr' ? 'HR Department' : task.assignedTo === 'it' ? 'IT Department' : 'Admin Team'}
            </div>
        </td>
        <td>
            <div class="d-flex align-items-center">
                <i class="far fa-calendar-alt text-muted me-2"></i>
                <span class="${isOverdue ? 'text-danger' : ''}">${dueDateText}</span>
            </div>
        </td>
        <td class="text-end pe-4">
            <div class="dropdown">
                <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" 
                        id="task${task.id}Dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="task${task.id}Dropdown">
                    <li>
                        <a class="dropdown-item" href="#" onclick="markComplete(${task.id}, ${!task.completed})">
                            <i class="fas fa-${task.completed ? 'undo' : 'check'} me-2"></i>${task.completed ? 'Mark as Incomplete' : 'Mark as Complete'}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#reassignModal" data-task-id="${task.id}">
                            <i class="fas fa-user-edit me-2"></i>Reassign Task
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editTaskModal" data-task-id="${task.id}">
                            <i class="far fa-edit me-2"></i>Edit Task
                        </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item text-danger" href="#" onclick="deleteTask(${task.id})">
                            <i class="far fa-trash-alt me-2"></i>Delete
                        </a>
                    </li>
                </ul>
            </div>
        </td>
    `;
    
    return taskElement;
}

// Update the progress bar and counters
function updateProgress() {
    const totalTasks = tasks.length;
    const completedTasks = tasks.filter(task => task.completed).length;
    const inProgressTasks = tasks.filter(task => task.status === 'in-progress' && !task.completed).length;
    const overdueTasks = tasks.filter(task => {
        const dueDate = new Date(task.dueDate);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return dueDate < today && !task.completed;
    }).length;
    
    const progress = Math.round((completedTasks / totalTasks) * 100) || 0;
    
    // Update progress bar
    progressBar.style.width = `${progress}%`;
    progressBar.setAttribute('aria-valuenow', progress);
    progressText.textContent = `${progress}% Complete`;
    
    // Update counters
    taskCounts.total.textContent = totalTasks;
    taskCounts.completed.textContent = completedTasks;
    taskCounts.inProgress.textContent = inProgressTasks;
    taskCounts.overdue.textContent = overdueTasks;
    
    // Update overdue warning
    const overdueWarning = document.querySelector('.text-warning');
    if (overdueWarning) {
        overdueWarning.innerHTML = overdueTasks > 0 
            ? `<i class="fas fa-exclamation-triangle me-1"></i> ${overdueTasks} task${overdueTasks > 1 ? 's' : ''} overdue`
            : '';
    }
}

// Set up event listeners
function setupEventListeners() {
    // Task checkboxes
    document.addEventListener('change', function(e) {
        if (e.target.matches('.task-checkbox')) {
            const taskId = parseInt(e.target.dataset.taskId);
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = e.target.checked;
                task.status = e.target.checked ? 'completed' : 'pending';
                updateTaskList();
                updateProgress();
            }
        }
    });
    
    // Filter checkboxes
    document.querySelectorAll('.filter-status, .filter-assigned').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if (this.value === 'all') {
                // If "All" is checked, uncheck other checkboxes in the same group
                const groupName = this.classList.contains('filter-status') ? 'filter-status' : 'filter-assigned';
                document.querySelectorAll(`.${groupName}:not(#filterAll):not(#filterAllDepartments)`).forEach(cb => {
                    if (cb !== this) cb.checked = false;
                });
            } else {
                // If a specific filter is checked, uncheck "All"
                const allCheckbox = this.classList.contains('filter-status') 
                    ? document.getElementById('filterAll') 
                    : document.getElementById('filterAllDepartments');
                if (allCheckbox) allCheckbox.checked = false;
            }
            updateTaskList();
        });
    });
    
    // Apply filters button
    const applyFiltersBtn = document.getElementById('applyFilters');
    if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', function() {
            applyFilters();
        });
    }
    
    // Reset filters button
    const resetFiltersBtn = document.getElementById('resetFilters');
    if (resetFiltersBtn) {
        resetFiltersBtn.addEventListener('click', function() {
            // Uncheck all filters
            document.querySelectorAll('.filter-status, .filter-assigned').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Check "All" checkboxes
            const filterAll = document.getElementById('filterAll');
            const filterAllDepts = document.getElementById('filterAllDepartments');
            
            if (filterAll) filterAll.checked = true;
            if (filterAllDepts) filterAllDepts.checked = true;
            
            // Show all tasks
            document.querySelectorAll('.task-item').forEach(task => {
                task.style.display = '';
            });
            
            // Update the UI to reflect the reset
            updateProgress();
        });
    }
    
    // Reassign task modal
    const reassignModal = document.getElementById('reassignModal');
    if (reassignModal) {
        reassignModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const taskId = button.getAttribute('data-task-id');
            const modal = this;
            modal.querySelector('#taskId').value = taskId;
        });
    }
    
    // Edit task modal
    const editTaskModal = document.getElementById('editTaskModal');
    if (editTaskModal) {
        editTaskModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const taskId = parseInt(button.getAttribute('data-task-id'));
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                const modal = this;
                modal.querySelector('#editTaskId').value = task.id;
                modal.querySelector('#editTaskTitle').value = task.title;
                modal.querySelector('#editTaskDescription').value = task.description;
                modal.querySelector('#editTaskDueDate').value = task.dueDate;
                modal.querySelector(`#editTaskStatus option[value="${task.status}"]`).selected = true;
                modal.querySelector(`#editTaskAssignedTo option[value="${task.assignedTo}"]`).selected = true;
            }
        });
    }
}

// Show toast notification
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) return;
    
    const toastId = 'toast-' + Date.now();
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    toast.id = toastId;
    
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'danger' ? 'fa-exclamation-circle' : 'fa-info-circle'} me-2"></i>
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    const bsToast = new bootstrap.Toast(toast, { autohide: true, delay: 3000 });
    bsToast.show();
    
    // Remove the toast from DOM after it's hidden
    toast.addEventListener('hidden.bs.toast', function() {
        toast.remove();
    });
}

// Mark a task as complete/incomplete
function markComplete(taskId, complete = true) {
    const task = tasks.find(t => t.id === taskId);
    if (task) {
        task.completed = complete;
        task.status = complete ? 'completed' : 'pending';
        updateTaskList();
        updateProgress();
        
        showToast(
            `Task "${task.title}" marked as ${complete ? 'complete' : 'incomplete'}`,
            complete ? 'success' : 'info'
        );
    }
}

// Delete a task
function deleteTask(taskId) {
    if (confirm('Are you sure you want to delete this task?')) {
        tasks = tasks.filter(t => t.id !== taskId);
        updateTaskList();
        updateProgress();
        showToast('Task deleted', 'danger');
    }
}

// Save task changes from edit modal
function saveTaskChanges() {
    const taskId = parseInt(document.getElementById('editTaskId').value);
    const task = tasks.find(t => t.id === taskId);
    
    if (task) {
        task.title = document.getElementById('editTaskTitle').value;
        task.description = document.getElementById('editTaskDescription').value;
        task.dueDate = document.getElementById('editTaskDueDate').value;
        task.status = document.getElementById('editTaskStatus').value;
        task.assignedTo = document.getElementById('editTaskAssignedTo').value;
        
        updateTaskList();
        updateProgress();
        
        // Hide the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('editTaskModal'));
        if (modal) modal.hide();
        
        showToast('Task updated successfully', 'success');
    }
}

// Reassign a task
function reassignTask() {
    const taskId = parseInt(document.getElementById('taskId').value);
    const newAssignee = document.getElementById('newAssignee').value;
    const task = tasks.find(t => t.id === taskId);
    
    if (task) {
        const oldAssignee = task.assignedTo;
        task.assignedTo = newAssignee;
        
        updateTaskList();
        updateProgress();
        
        // Hide the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('reassignModal'));
        if (modal) modal.hide();
        
        showToast(`Task reassigned to ${newAssignee === 'hr' ? 'HR Department' : newAssignee === 'it' ? 'IT Department' : 'Admin Team'}`, 'info');
    }
}

// Start onboarding for the selected candidate
function startOnboarding(candidateId) {
        const candidate = sampleCandidates.find(c => c.id === candidateId);
        if (!candidate) return;

        // Update the UI with candidate details
        document.getElementById('candidateName').textContent = candidate.name;
        document.getElementById('candidateEmail').textContent = candidate.email;
        document.getElementById('candidatePosition').textContent = candidate.position;
        document.getElementById('candidateExperience').textContent = candidate.experience;
        document.getElementById('candidateSkills').textContent = candidate.skills;
        
        // Set hire date to today
        const today = new Date();
        document.getElementById('hireDate').textContent = today.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });

        // Show the new hire card
        document.getElementById('newHireCard').classList.remove('d-none');

        // Auto-fill the new hire form
        document.getElementById('newHireName').value = candidate.name;
        document.getElementById('newHireEmail').value = candidate.email;
        document.getElementById('newHireDepartment').value = candidate.position.includes('Design') ? 'design' : 
                                                           candidate.position.includes('Data') ? 'data' : 'engineering';
        
        // Set start date to next Monday
        const nextMonday = new Date();
        const dayOfWeek = nextMonday.getDay();
        const daysUntilMonday = dayOfWeek === 0 ? 1 : 8 - dayOfWeek;
        nextMonday.setDate(nextMonday.getDate() + daysUntilMonday);
        document.getElementById('newHireStartDate').valueAsDate = nextMonday;

        // Close the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('selectCandidateModal'));
        if (modal) modal.hide();
    };

    // Reset the onboarding process
function resetOnboarding() {
    if (confirm('Are you sure you want to reset the onboarding process? This will clear all task progress.')) {
        // Reset task statuses
        tasks.forEach(task => {
            task.completed = false;
            task.status = 'pending';
        });
        
        updateTaskList();
        updateProgress();
        
        showToast('Onboarding process has been reset', 'warning');
    }
}

    // Toggle task completion for employee-specific onboarding
    function toggleTaskCompletion(taskId, completed) {
        fetch(`/api/onboarding/tasks/${taskId}/toggle`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ completed: completed })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Reload the page to reflect changes
                location.reload();
            } else {
                alert('Failed to update task: ' + (data.message || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to update task');
        });
    }

    // Mark task as complete
    function markComplete(button) {
        const taskId = parseInt(button.closest('tr').querySelector('.task-checkbox').dataset.taskId);
        markComplete(taskId, true);
        statusBadge.className = 'badge bg-success';
        statusBadge.textContent = 'Completed';
        button.disabled = true;
        updateProgress();
    }

    // Open reassign task modal
    function reassignTask(button) {
        const row = button.closest('tr');
        const taskName = row.cells[0].textContent;
        document.getElementById('taskName').value = taskName;
        
        // Set default due date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('dueDate').valueAsDate = tomorrow;
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('reassignModal'));
        modal.show();
    }

    // Confirm task reassignment
    function confirmReassignment() {
        // In a real app, this would make an API call to update the task
        const assignTo = document.getElementById('assignTo');
        const department = assignTo.options[assignTo.selectedIndex].text;
        const dueDate = document.getElementById('dueDate').value;
        
        // Update the table (simplified example)
        // In a real app, you would update the specific task
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('reassignModal'));
        modal.hide();
        
        // Show success message
        alert(`Task has been reassigned to ${department} with due date ${dueDate}`);
    }

    // Add new hire and initialize onboarding
    function addNewHire() {
        // In a real app, this would make an API call to create a new hire
        const name = document.getElementById('newHireName').value;
        const email = document.getElementById('newHireEmail').value;
        const department = document.getElementById('newHireDepartment').value;
        const startDate = document.getElementById('newHireStartDate').value;
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('newHireModal'));
        modal.hide();
        
        // Show success message
        alert(`Onboarding for ${name} has been started!`);
        
        // Reset form
        document.getElementById('newHireForm').reset();
    }

    // Update progress bar
    function updateProgress() {
        const totalTasks = document.querySelectorAll('#onboardingTasks tr').length;
        const completedTasks = document.querySelectorAll('#onboardingTasks .bg-success').length;
        const progress = Math.round((completedTasks / totalTasks) * 100);
        
        const progressBar = document.querySelector('.progress-bar');
        progressBar.style.width = `${progress}%`;
        progressBar.setAttribute('aria-valuenow', progress);
        progressBar.textContent = `${progress}%`;
        
        // Update completed tasks count
        document.querySelector('.list-group-item:nth-child(2) .badge').textContent = completedTasks;
        
        // Update pending tasks count
        document.querySelector('.list-group-item:nth-child(1) .badge').textContent = totalTasks - completedTasks;
    }

    // Initialize date picker for start date (set min date to today)
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        const startDateInput = document.getElementById('newHireStartDate');
        if (startDateInput) {
            startDateInput.min = today;
        }
    });
</script>

<!-- Employee Selection and Auto-fill Script -->
<script src="{{ url_for('static', filename='js/onboarding-selection.js') }}"></script>

{% endblock %}
