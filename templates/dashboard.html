{% extends "base.html" %}

{% block title %}HR Dashboard - SmartHire AI{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- HR User Info Header -->
    <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
        <div class="card-body py-3">
            <div class="d-flex align-items-center">
                <div class="me-4">
                    <div class="avatar-lg bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 70px; height: 70px;">
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                </div>
                <div class="flex-grow-1">
                    <h4 class="mb-1 text-light">Welcome, {{ user.full_name }}</h4>
                    <p class="mb-0 text-muted">
                        <i class="fas fa-briefcase me-2"></i>HR Manager
                        <span class="mx-2">•</span>
                        <i class="fas fa-envelope me-2"></i>{{ user.email }}
                        <span class="mx-2">•</span>
                        <i class="fas fa-phone me-2"></i>{{ user.phone }}
                    </p>
                </div>
                <div class="ms-3">
                    <a href="{{ url_for('list_employees') }}" class="btn btn-outline-light me-2">
                        <i class="fas fa-users me-1"></i> View All Employees
                    </a>
                    <a href="{{ url_for('add_employee') }}" class="btn btn-primary">
                        <i class="fas fa-user-plus me-1"></i> Add New Employee
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 text-light mb-0">HR Insights & Strategy Dashboard</h1>
            <p class="text-muted mb-0">Welcome to your HR command center</p>
        </div>
        <div>
            <a href="{{ url_for('add_employee') }}" class="btn btn-primary me-2">
                <i class="fas fa-user-plus me-1"></i> Add Employee
            </a>
            <a href="#" class="btn btn-outline-light">
                <i class="fas fa-download me-1"></i> Export
            </a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <!-- Total Employees -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark bg-opacity-25 border-secondary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                            <i class="fas fa-users text-primary"></i>
                        </div>
                        <div class="text-end">
                            <h3 class="mb-0 text-light">{{ total_employees }}</h3>
                            <span class="text-muted small">Total Employees</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('list_employees') }}" class="small text-primary text-decoration-none">
                            View All <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Onboarding -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark bg-opacity-25 border-secondary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="bg-warning bg-opacity-10 p-3 rounded-circle">
                            <i class="fas fa-user-clock text-warning"></i>
                        </div>
                        <div class="text-end">
                            <h3 class="mb-0 text-light">{{ onboarding_count }}</h3>
                            <span class="text-muted small">In Onboarding</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="#" class="small text-warning text-decoration-none">
                            View Onboarding <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Active Employees -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark bg-opacity-25 border-secondary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase text-muted small">Avg. Onboarding</h6>
                            <h3 class="mb-0 text-light">7.2 <small class="text-muted">days</small></h3>
                            <span class="text-success small"><i class="bi bi-arrow-down"></i> 12% from last month</span>
                        </div>
                        <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-clock-history text-primary fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark bg-opacity-25 border-secondary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase text-muted small">Avg. Exit Time</h6>
                            <h3 class="mb-0 text-light">14.5 <small class="text-muted">days</small></h3>
                            <span class="text-danger small"><i class="bi bi-arrow-up"></i> 8% from last month</span>
                        </div>
                        <div class="bg-danger bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-box-arrow-right text-danger fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark bg-opacity-25 border-secondary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase text-muted small">Active Employees</h6>
                            <h3 class="mb-0 text-light">247</h3>
                            <span class="text-success small"><i class="bi bi-arrow-up"></i> 5.2% this month</span>
                        </div>
                        <div class="bg-success bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-people-fill text-success fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark bg-opacity-25 border-secondary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase text-muted small">Engagement Score</h6>
                            <h3 class="mb-0 text-light">78%</h3>
                            <span class="text-warning small"><i class="bi bi-dash"></i> 2% from last month</span>
                        </div>
                        <div class="bg-warning bg-opacity-10 p-3 rounded-circle">
                            <i class="bi bi-graph-up text-warning fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Engagement Trend -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="text-uppercase text-light-50 fw-bold mb-0">ENGAGEMENT TREND</h6>
                        <div class="btn-group btn-group-sm" role="group" aria-label="Time period">
                            <button type="button" class="btn btn-outline-light active" data-period="6M">6M</button>
                            <button type="button" class="btn btn-outline-light" data-period="1Y">1Y</button>
                            <button type="button" class="btn btn-outline-light" data-period="All">All</button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="position-relative" style="height: 300px;">
                        <div class="position-absolute w-100 h-100 d-flex align-items-center justify-content-center" id="chartLoading" style="background: rgba(0,0,0,0.5);">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <canvas id="engagementChart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                    <div class="card-footer bg-transparent border-0 pt-0">
                        <div class="row g-2 text-center">
                            <div class="col-4">
                                <div class="p-2 border rounded bg-dark bg-opacity-50">
                                    <div class="text-muted small">Current</div>
                                    <div class="h5 mb-0 text-light">78%</div>
                                    <span class="text-success small"><i class="bi bi-arrow-up"></i> 2.5%</span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="p-2 border rounded bg-dark bg-opacity-50">
                                    <div class="text-muted small">Avg. 6M</div>
                                    <div class="h5 mb-0 text-light">75%</div>
                                    <span class="text-success small"><i class="bi bi-arrow-up"></i> 5.1%</span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="p-2 border rounded bg-dark bg-opacity-50">
                                    <div class="text-muted small">Peak</div>
                                    <div class="h5 mb-0 text-light">82%</div>
                                    <span class="text-muted small">Mar 2023</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exit Reasons Analysis -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-0">
                    <h6 class="text-uppercase text-light-50 small fw-bold mb-0">Exit Reasons Analysis</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="text-light small">Career Growth</span>
                                <span class="text-light-50 small">42%</span>
                            </div>
                            <div class="progress bg-dark bg-opacity-50" style="height: 8px;">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 42%;"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="text-light small">Compensation</span>
                                <span class="text-light-50 small">28%</span>
                            </div>
                            <div class="progress bg-dark bg-opacity-50" style="height: 8px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 28%;"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="text-light small">Management</span>
                                <span class="text-light-50 small">15%</span>
                            </div>
                            <div class="progress bg-dark bg-opacity-50" style="height: 8px;">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 15%;"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="text-light small">Work-Life Balance</span>
                                <span class="text-light-50 small">10%</span>
                            </div>
                            <div class="progress bg-dark bg-opacity-50" style="height: 8px;">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 10%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Department-wise Issues -->
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-header bg-transparent border-0">
                    <h6 class="text-uppercase text-light-50 small fw-bold mb-0">Department-wise Issues</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-dark table-borderless">
                            <thead>
                                <tr class="border-secondary">
                                    <th>Department</th>
                                    <th>Active Issues</th>
                                    <th>Avg. Resolve Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Engineering</td>
                                    <td>12</td>
                                    <td>3.2 days</td>
                                    <td><span class="badge bg-warning">Needs Attention</span></td>
                                </tr>
                                <tr>
                                    <td>Sales</td>
                                    <td>8</td>
                                    <td>2.1 days</td>
                                    <td><span class="badge bg-success">Stable</span></td>
                                </tr>
                                <tr>
                                    <td>Marketing</td>
                                    <td>5</td>
                                    <td>1.8 days</td>
                                    <td><span class="badge bg-success">Stable</span></td>
                                </tr>
                                <tr>
                                    <td>HR</td>
                                    <td>3</td>
                                    <td>1.2 days</td>
                                    <td><span class="badge bg-success">Stable</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- Common Onboarding Delays -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-0">
                    <h6 class="text-uppercase text-light-50 small fw-bold mb-0">Common Onboarding Delays</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-light small">Background Check</span>
                            <span class="text-light-50 small">42% delayed</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 6px;">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: 42%;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-light small">Equipment Setup</span>
                            <span class="text-light-50 small">28% delayed</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 6px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 28%;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-light small">Training Completion</span>
                            <span class="text-light-50 small">15% delayed</span>
                        </div>
                        <div class="progress bg-dark bg-opacity-50" style="height: 6px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 15%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Most Frequently Late Tasks -->
            <div class="card bg-dark bg-opacity-25 border-secondary mb-4">
                <div class="card-header bg-transparent border-0">
                    <h6 class="text-uppercase text-light-50 small fw-bold mb-0">Frequently Late Tasks</h6>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 text-light">Background Verification</h6>
                                <small class="text-danger">+3.2 days</small>
                            </div>
                            <small class="text-muted">HR Department</small>
                        </div>
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 text-light">Laptop Setup</h6>
                                <small class="text-warning">+1.5 days</small>
                            </div>
                            <small class="text-muted">IT Department</small>
                        </div>
                        <div class="list-group-item bg-transparent border-secondary">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 text-light">Security Badge</h6>
                                <small class="text-warning">+1.2 days</small>
                            </div>
                            <small class="text-muted">Facilities</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card bg-dark bg-opacity-25 border-secondary">
                <div class="card-header bg-transparent border-0">
                    <h6 class="text-uppercase text-light-50 small fw-bold mb-0">Quick Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
                            <i class="bi bi-person-plus me-2"></i> Add New Employee
                        </button>
                        <button class="btn btn-primary mb-2" id="searchEmployeeBtn">
                            <i class="bi bi-search me-2"></i> Search Employee
                        </button>
                        <button class="btn btn-primary mb-2" id="generateReportBtn">
                            <i class="bi bi-file-earmark-pdf me-2"></i> Generate Report
                        </button>
                        <button class="btn btn-primary mb-2" id="scheduleMeetingBtn">
                            <i class="bi bi-calendar-plus me-2"></i> Schedule Meeting
                        </button>
                        <button class="btn btn-primary" id="viewAnalyticsBtn">
                            <i class="bi bi-graph-up me-2"></i> View Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Employee Modal -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-light">Add New Employee</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label text-light-50">Full Name</label>
                        <input type="text" class="form-control bg-dark text-light border-secondary">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-light-50">Email</label>
                        <input type="email" class="form-control bg-dark text-light border-secondary">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-light-50">Department</label>
                        <select class="form-select bg-dark text-light border-secondary">
                            <option>Select Department</option>
                            <option>Engineering</option>
                            <option>Sales</option>
                            <option>Marketing</option>
                            <option>HR</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-light-50">Position</label>
                        <input type="text" class="form-control bg-dark text-light border-secondary">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-light-50">Start Date</label>
                        <input type="date" class="form-control bg-dark text-light border-secondary">
                    </div>
                </form>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Add Employee</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Add required Chart.js plugins -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1"></script>

<script>
// Register the zoom plugin
Chart.register(ChartZoom);

document.addEventListener('DOMContentLoaded', function() {
    // Initialize chart elements
    const chartLoading = document.getElementById('chartLoading');
    const chartCanvas = document.getElementById('engagementChart');
    const ctx = chartCanvas.getContext('2d');
    
    // Chart data for different time periods
    const chartData = {
        '6M': {
            labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            data: [82, 84, 85, 87, 86, 88]
        },
        '1Y': {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            data: [75, 76, 78, 80, 82, 81, 82, 84, 85, 87, 86, 88]
        },
        'All': {
            labels: ['2022 Q1', '2022 Q2', '2022 Q3', '2022 Q4', '2023 Q1', '2023 Q2', '2023 Q3', '2023 Q4'],
            data: [70, 72, 74, 76, 78, 80, 82, 84]
        }
    };
    
    // Initialize chart with default data
    const engagementChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData['6M'].labels,
            datasets: [{
                label: 'Engagement Score',
                data: chartData['6M'].data,
                borderColor: '#4e73df',
                backgroundColor: 'rgba(78, 115, 223, 0.2)',
                borderWidth: 2,
                tension: 0.3,
                fill: true,
                pointBackgroundColor: '#fff',
                pointBorderColor: '#4e73df',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 1000
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: '#dee2e6',
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: '#4e73df',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(108, 117, 125, 0.2)',
                        display: true
                    },
                    ticks: {
                        color: '#adb5bd'
                    }
                },
                y: {
                    min: 60,
                    max: 100,
                    grid: {
                        color: 'rgba(108, 117, 125, 0.2)'
                    },
                    ticks: {
                        color: '#adb5bd',
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
    
    // Update chart when time period changes
    document.querySelectorAll('[data-period]').forEach(button => {
        button.addEventListener('click', function() {
            const period = this.getAttribute('data-period');
            
            // Update active button
            document.querySelectorAll('[data-period]').forEach(btn => {
                btn.classList.remove('active');
            });
            this.classList.add('active');
            
            // Show loading
            chartLoading.style.opacity = '1';
            chartLoading.style.display = 'flex';
            
            // Simulate data loading
            setTimeout(() => {
                engagementChart.data.labels = chartData[period].labels;
                engagementChart.data.datasets[0].data = chartData[period].data;
                engagementChart.update();
                
                // Hide loading
                chartLoading.style.opacity = '0';
                setTimeout(() => {
                    chartLoading.style.display = 'none';
                }, 300);
            }, 500);
        });
    });
    
    // Hide loading spinner after chart is ready
    setTimeout(() => {
        chartLoading.style.opacity = '0';
        setTimeout(() => {
            chartLoading.style.display = 'none';
        }, 300);
    }, 1000);
    
    // Initialize with 6M data by default
    const timePeriods = {
        '6M': {
            labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            data: [85, 83, 87, 85, 88, 90]
        },
        '1Y': {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            data: [72, 75, 78, 76, 80, 82, 85, 83, 87, 85, 88, 90]
        },
        'All': {
            labels: ['2022 Q1', '2022 Q2', '2022 Q3', '2022 Q4', '2023 Q1', '2023 Q2', '2023 Q3', '2023 Q4'],
            data: [68, 70, 72, 74, 75, 78, 82, 85]
        }
    };

    // Set initial data for 6M view
    let currentData = timePeriods['6M'];
    
    // Update chart function
    function updateChart(period) {
        const periodData = timePeriods[period];
        if (!periodData) return;
        
        currentData = periodData;
        engagementChart.data.labels = periodData.labels;
        engagementChart.data.datasets[0].data = periodData.data;
        engagementChart.update();
    }
    
    // Add click handlers for period buttons
    document.querySelectorAll('[data-period]').forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            document.querySelectorAll('[data-period]').forEach(btn => {
                btn.classList.remove('active');
            });
            // Add active class to clicked button
            this.classList.add('active');
            // Update chart with selected period
            updateChart(this.dataset.period);
        });
    });
    
    // Hide loading spinner and show chart after a short delay
    setTimeout(() => {
        if (chartLoading) {
            chartLoading.style.opacity = '0';
            setTimeout(() => {
                chartLoading.style.display = 'none';
                chartCanvas.style.opacity = '1';
            }, 300);
        }
    
    const engagementChart = new Chart(ctx, {
        type: 'line',
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#dee2e6',
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(33, 37, 41, 0.95)',
                    titleColor: '#fff',
                    bodyColor: '#dee2e6',
                    borderColor: '#495057',
                    borderWidth: 1,
                    displayColors: true,
                    padding: 10,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += context.parsed.y + '%';
                            }
                            return label;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(108, 117, 125, 0.2)'
                    },
                    ticks: {
                        color: '#adb5bd'
                    }
                },
                y: {
                    min: 0,
                    max: 100,
                    grid: {
                        color: 'rgba(108, 117, 125, 0.2)'
                    },
                    ticks: {
                        color: '#adb5bd',
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        },
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [
                {
                    label: 'Engagement Score',
                    data: [72, 75, 78, 76, 80, 82, 85, 83, 87, 85, 88, 90],
                    borderColor: '#4e73df',
                    backgroundColor: 'rgba(78, 115, 223, 0.2)',
                    borderWidth: 2,
                    tension: 0.3,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#4e73df',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#4e73df',
                    pointHoverBorderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    yAxisID: 'y'
                },
                {
                    label: 'Employee Satisfaction',
                    data: [68, 70, 73, 75, 77, 79, 81, 82, 84, 83, 85, 87],
                    borderColor: 'rgba(25, 135, 84, 1)',
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.3,
                    yAxisID: 'y'
                },
                {
                    label: 'Retention Rate %',
                    data: [88, 87, 89, 88, 90, 91, 90, 91, 92, 93, 94, 95],
                    borderColor: 'rgba(255, 193, 7, 1)',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    borderWidth: 2,
                    borderDash: [3, 3],
                    fill: false,
                    tension: 0.3,
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#dee2e6',
                        padding: 20,
                        boxWidth: 12,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(33, 37, 41, 0.95)',
                    titleColor: '#fff',
                    bodyColor: '#dee2e6',
                    borderColor: '#495057',
                    borderWidth: 1,
                    padding: 12,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += context.datasetIndex === 2 ? context.parsed.y + '%' : context.parsed.y;
                                if (context.datasetIndex === 0) {
                                    label += '/100';
                                } else if (context.datasetIndex === 1) {
                                    label += '/100';
                                }
                            }
                            return label;
                        }
                    }
                },
                zoom: {
                    zoom: {
                        wheel: {
                            enabled: true
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'x',
                        speed: 100
                    },
                    pan: {
                        enabled: true,
                        mode: 'x',
                        speed: 0.5
                    }
                }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: 'Score',
                        color: '#adb5bd'
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#adb5bd',
                        callback: function(value) {
                            return value + (this === engagementChart.scales.y ? '' : '%');
                        }
                    },
                    min: 60,
                    max: 100
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Retention %',
                        color: '#adb5bd'
                    },
                    grid: {
                        drawOnChartArea: false,
                    },
                    ticks: {
                        color: '#ffc107',
                        callback: function(value) {
                            return value + '%';
                        }
                    },
                    min: 80,
                    max: 100
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#adb5bd'
                    }
                }
            }
        }
    });

    // Initialize tooltips and modals first
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Initialize modals
    var myModal = new bootstrap.Modal(document.getElementById('addEmployeeModal'), {
        keyboard: true
    });

    // Quick Actions Functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Search Employee
        const searchEmployeeBtn = document.getElementById('searchEmployeeBtn');
        if (searchEmployeeBtn) {
            searchEmployeeBtn.addEventListener('click', function() {
                const searchTerm = prompt('Enter employee name or ID:');
                if (searchTerm) {
                    const toast = showToast('Searching for: ' + searchTerm, 'info');
                    setTimeout(() => {
                        toast.querySelector('.toast-body').textContent = `Found 5 results for "${searchTerm}"`;
                        setTimeout(() => toast.remove(), 3000);
                    }, 1500);
                }
            });
        }

        // Generate Report
        const generateReportBtn = document.getElementById('generateReportBtn');
        if (generateReportBtn) {
            generateReportBtn.addEventListener('click', function() {
                const toast = showToast('Generating report...', 'info');
                
                // Simulate report generation
                setTimeout(() => {
                    toast.querySelector('.toast-body').innerHTML = 'Report generated successfully! <a href="#" class="text-white fw-bold ms-2">Download</a>';
                    setTimeout(() => toast.remove(), 5000);
                }, 2000);
            });
        }

        // Schedule Meeting
        const scheduleMeetingBtn = document.getElementById('scheduleMeetingBtn');
        if (scheduleMeetingBtn) {
            scheduleMeetingBtn.addEventListener('click', function() {
                const meetingTitle = prompt('Enter meeting title:');
                if (meetingTitle) {
                    const date = new Date();
                    date.setDate(date.getDate() + 1);
                    const defaultDate = date.toISOString().split('T')[0];
                    const meetingDate = prompt('Enter meeting date (YYYY-MM-DD):', defaultDate);
                    if (meetingDate) {
                        showToast(`Meeting "${meetingTitle}" scheduled for ${meetingDate}`, 'success');
                    }
                }
            });
        }

        // View Analytics
        const viewAnalyticsBtn = document.getElementById('viewAnalyticsBtn');
        if (viewAnalyticsBtn) {
            viewAnalyticsBtn.addEventListener('click', function() {
                const chartContainer = document.querySelector('.card-body[style*="height: 300px"]');
                if (!chartContainer) return;
                
                const isFullscreen = chartContainer.classList.toggle('fullscreen-chart');
                
                if (isFullscreen) {
                    chartContainer.style.height = '70vh';
                    const chart = document.querySelector('#engagementChart');
                    if (chart) chart.style.cursor = 'move';
                    if (typeof engagementChart !== 'undefined') {
                        engagementChart.resize();
                    }
                    viewAnalyticsBtn.innerHTML = '<i class="bi bi-fullscreen-exit me-2"></i> Exit Fullscreen';
                    document.body.style.overflow = 'hidden';
                } else {
                    chartContainer.style.height = '300px';
                    const chart = document.querySelector('#engagementChart');
                    if (chart) chart.style.cursor = 'default';
                    if (typeof engagementChart !== 'undefined') {
                        if (engagementChart.resetZoom) engagementChart.resetZoom();
                        engagementChart.resize();
                    }
                    viewAnalyticsBtn.innerHTML = '<i class="bi bi-arrows-fullscreen me-2"></i> View Analytics';
                    document.body.style.overflow = '';
                }
            });
        }
        
        // Helper function to show toast notifications
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer') || (() => {
                const container = document.createElement('div');
                container.id = 'toastContainer';
                container.style.position = 'fixed';
                container.style.bottom = '1rem';
                container.style.right = '1rem';
                container.style.zIndex = '1100';
                document.body.appendChild(container);
                return container;
            })();

            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = 'toast show';
            toast.role = 'alert';
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            const bgClass = {
                'success': 'bg-success',
                'error': 'bg-danger',
                'warning': 'bg-warning',
                'info': 'bg-info'
            }[type] || 'bg-primary';
            
            toast.innerHTML = `
                <div class="toast-header ${bgClass} text-white">
                    <strong class="me-auto">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body bg-dark text-light">
                    ${message}
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove toast after 5 seconds
            setTimeout(() => {
                const toastElement = document.getElementById(toastId);
                if (toastElement) {
                    toastElement.classList.remove('show');
                    setTimeout(() => toastElement.remove(), 300);
                }
            }, 5000);
            
            return toast;
        }

        // Add smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    });

    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Initialize popovers
    const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl);
    });

    // Initialize charts
    if (typeof engagementChart !== 'undefined') {
        engagementChart.update();
    }
    });
</script>

<style>
    /* Additional styles for the enhanced chart */
    .fullscreen-chart {
        position: fixed !important;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1050;
        background-color: rgba(0, 0, 0, 0.9);
        padding: 20px;
        transition: all 0.3s ease;
    }
    
    /* Custom scrollbar for the chart container */
    .chart-container {
        scrollbar-width: thin;
        scrollbar-color: #495057 #212529;
    }
    
    .chart-container::-webkit-scrollbar {
        height: 8px;
        width: 8px;
    }
    
    .chart-container::-webkit-scrollbar-track {
        background: #212529;
    }
    
    .chart-container::-webkit-scrollbar-thumb {
        background-color: #495057;
        border-radius: 4px;
    }
    
    /* Hover effects for quick action buttons */
    .btn-outline-light:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease-in-out;
    }
    
    /* Animation for the toast */
    @keyframes slideInUp {
        from {
            transform: translateY(100%);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    .toast {
        animation: slideInUp 0.3s ease-out;
    }
</style>

<script>
// Close any open tooltips when clicking elsewhere
document.addEventListener('click', function(e) {
    if (!e.target.closest('[data-bs-toggle="tooltip"]')) {
        const tooltips = [].slice.call(document.querySelectorAll('.tooltip'));
        tooltips.forEach(tooltip => {
            const tooltipInstance = bootstrap.Tooltip.getInstance(tooltip);
            if (tooltipInstance) {
                tooltipInstance.hide();
            }
        });
    }
});
</script>

{% endblock %}
